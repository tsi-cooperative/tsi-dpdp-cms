# Schema Definitions
1=CREATE TABLE IF NOT EXISTS _role (role_id UUID PRIMARY KEY, name VARCHAR(100) NOT NULL UNIQUE, description TEXT, permissions JSONB NOT NULL DEFAULT '[]',created_at TIMESTAMP NOT NULL DEFAULT NOW(),last_updated_at TIMESTAMP NOT NULL DEFAULT NOW());
2=CREATE TABLE IF NOT EXISTS _user (user_id UUID PRIMARY KEY, role_id UUID NOT NULL, username VARCHAR(100) NOT NULL UNIQUE, email VARCHAR(255) NOT NULL UNIQUE, password_hash VARCHAR(255) NOT NULL, mfa_secret VARCHAR(255), mfa_enabled BOOLEAN NOT NULL DEFAULT FALSE, status SMALLINT DEFAULT 1, created_at TIMESTAMP NOT NULL DEFAULT NOW(), last_login_at TIMESTAMP, last_updated_at TIMESTAMP NOT NULL DEFAULT NOW());
3=CREATE TABLE IF NOT EXISTS _consent_manager (cm_id UUID PRIMARY KEY,name VARCHAR(60) NOT NULL UNIQUE,description VARCHAR(1000),cname VARCHAR(20) NOT NULL, domain VARCHAR(30) NOT NULL, dns_txt_record_token VARCHAR(255) UNIQUE, domain_validation_status VARCHAR(50) NOT NULL DEFAULT 'PENDING', status SMALLINT DEFAULT 1, created_at TIMESTAMP NOT NULL DEFAULT NOW(),last_updated_at TIMESTAMP NOT NULL DEFAULT NOW());
4=CREATE TABLE IF NOT EXISTS _data_fiduciary (fiduciary_id UUID PRIMARY KEY,cm_id UUID,name VARCHAR(60) NOT NULL UNIQUE,contact_person VARCHAR(255), email VARCHAR(255) NOT NULL UNIQUE, phone VARCHAR(50), domain VARCHAR(255) NOT NULL UNIQUE,  is_significant_data_fiduciary BOOLEAN NOT NULL DEFAULT FALSE, dpo_user_id UUID, dpb_registration_id VARCHAR(100) UNIQUE, status SMALLINT DEFAULT 1, created_at TIMESTAMP NOT NULL DEFAULT NOW(),last_updated_at TIMESTAMP NOT NULL DEFAULT NOW());
5=CREATE TABLE IF NOT EXISTS _data_processor (processor_id UUID PRIMARY KEY,fiduciary_id UUID,name VARCHAR(60) NOT NULL,description VARCHAR(1000), contact_person VARCHAR(255), email VARCHAR(255), address TEXT, jurisdiction VARCHAR(50), dpa_reference VARCHAR(255) UNIQUE, dpa_effective_date DATE, dpa_expiry_date DATE, processing_purposes JSONB NOT NULL DEFAULT '[]', data_categories_processed JSONB NOT NULL DEFAULT '[]', status SMALLINT DEFAULT 1, created_at TIMESTAMP NOT NULL DEFAULT NOW(), created_by_user_id UUID REFERENCES _user(user_id), last_updated_at TIMESTAMP NOT NULL DEFAULT NOW(), last_updated_by_user_id UUID REFERENCES _user(user_id) );
6=CREATE TABLE IF NOT EXISTS _data_principal (principal_id UUID PRIMARY KEY,fiduciary_id UUID,email VARCHAR(30),mobile VARCHAR(10), status SMALLINT DEFAULT 1);
7=CREATE TABLE IF NOT EXISTS _policy (policy_id UUID PRIMARY KEY, name VARCHAR(100) NOT NULL UNIQUE, version VARCHAR(10) NOT NULL, fiduciary_id UUID NOT NULL REFERENCES _data_fiduciary(fiduciary_id), effective_date TIMESTAMP NOT NULL, status SMALLINT DEFAULT 1, jurisdiction VARCHAR(5) NOT NULL, policy_content JSONB NOT NULL, created_at TIMESTAMP NOT NULL DEFAULT NOW(), created_by_user_id UUID REFERENCES _user(user_id), last_updated_at TIMESTAMP NOT NULL DEFAULT NOW(), last_updated_by_user_id UUID REFERENCES _user(user_id));
8=CREATE TABLE IF NOT EXISTS _consent (consent_id UUID PRIMARY KEY, anon_user_id VARCHAR(60), principal_id UUID, fiduciary_id UUID NOT NULL, policy_id UUID NOT NULL, policy_version VARCHAR(10) NOT NULL, jurisdiction VARCHAR(5) NOT NULL, language_selected VARCHAR(5) NOT NULL, consent_status_general VARCHAR(50) NOT NULL, consent_mechanism VARCHAR(100) NOT NULL, ip_address INET, user_agent TEXT, data_point_consents JSONB NOT NULL, is_active_consent BOOLEAN NOT NULL DEFAULT TRUE, created_at TIMESTAMP NOT NULL DEFAULT NOW());
